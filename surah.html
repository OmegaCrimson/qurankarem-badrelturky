<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>سورة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Amiri', serif; background: #f8f9fa; }
    .ayah { margin-bottom: 1rem; font-size: 1.4rem; line-height: 2.2; }
    .ayah span { font-size: 0.9rem; margin-left: 0.5rem; color: #198754; }
    .verses { background: #fff; padding: 1.5rem; border-radius: 0.5rem; margin-top: 2rem; }
  </style>
</head>
<body>
  <header class="bg-success text-white text-center p-3">
    <h1>القرآن الكريم بصوت الشيخ <span id="reciter-name">...</span></h1>
  </header>

  <main class="container my-4">
    <div class="card shadow p-4" id="surah-card">
      <h2 class="text-center" id="surah-title">تحميل...</h2>
      <ul class="list-group mb-3" id="surah-details"></ul>
      <audio controls preload="none" class="w-100 mb-3" id="surah-audio"></audio>
      <div id="verses" class="verses"></div>
      <a href="index.html" class="btn btn-outline-success mt-3">⬅ العودة إلى القائمة</a>
    </div>
  </main>

  <footer class="text-center text-muted p-3">
    &copy; <span id="year"></span> القرآن الكريم بصوت الشيخ <span id="reciter-footer">...</span>
  </footer>

  <script>
    const params = new URLSearchParams(window.location.search);
    const surahId = parseInt(params.get('id'));
    const reciterKey = params.get('reciter') || 'bader';

    const reciterBaseURLs = {
      bader: 'https://server10.mp3quran.net/bader/Rewayat-Hafs-A-n-Assem/',
      husary: 'https://server13.mp3quran.net/husr/',
      minshawi: 'https://server11.mp3quran.net/minsh/'
    };

    const reciterNames = {
      bader: 'بدر التركي',
      husary: 'الحصري',
      minshawi: 'المنشاوي'
    };

    const reciterName = reciterNames[reciterKey] || 'بدر التركي';
    document.getElementById('reciter-name').textContent = reciterName;
    document.getElementById('reciter-footer').textContent = reciterName;

    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        const surah = data.surahs.find(s => s.id === surahId);
        if (!surah) {
          document.getElementById('surah-title').textContent = 'السورة غير موجودة';
          return;
        }

        document.title = `سورة ${surah.name}`;
        document.getElementById('surah-title').textContent = `سورة ${surah.name}`;

        const details = document.getElementById('surah-details');
        details.innerHTML = `
          <li class="list-group-item">الترتيب: ${surah.id}</li>
          <li class="list-group-item">عدد الآيات: ${surah.ayahs}</li>
          <li class="list-group-item">نوعها: ${surah.type}</li>
          <li class="list-group-item">أسماء أخرى: ${surah.other_names.join(", ")}</li>
          <li class="list-group-item">الموضوعات: ${surah.topics.join(", ")}</li>
        `;

        const audio = document.getElementById('surah-audio');
        const paddedId = String(surah.id).padStart(3, '0');
        const baseURL = reciterBaseURLs[reciterKey] || reciterBaseURLs['bader'];
        audio.src = `${baseURL}${paddedId}.mp3`;
        audio.dataset.surahId = surah.id;
      });

    // Load verses from XML
    fetch('quran-uthmani.xml')
      .then(res => res.text())
      .then(xmlText => {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "application/xml");
        const surahNode = xml.querySelector(`sura[index="${surahId}"]`);
        if (!surahNode) return;

        const verses = surahNode.querySelectorAll('aya');
        const versesContainer = document.getElementById('verses');
        verses.forEach(aya => {
          const text = aya.getAttribute('text');
          const index = aya.getAttribute('index');
          const p = document.createElement('p');
          p.className = 'ayah';
          p.innerHTML = `<span>(${index})</span> ${text}`;
          versesContainer.appendChild(p);
        });
      });

    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>

